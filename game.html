<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B√© √în B√†i - Ti·∫øng Vi·ªát L·ªõp 1</title>
    <style>
        /* --- ƒê√¢y l√† CSS (T·∫°o ki·ªÉu d√°ng) --- */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            display: flex; 
            justify-content: center; 
            align-items: flex-start; 
            min-height: 90vh;
            background-color: #f0f2f5; 
            color: #333;
            padding: 20px;
            gap: 25px; 
        }

        #main-content-column {
            flex: 3; 
            max-width: 700px; 
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 30px;
            border: 1px solid #e0e0e0;
        }

        #stats-column {
            flex: 1; 
            max-width: 250px; 
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            padding: 25px;
            border: 1px solid #ff7a7a; 
            text-align: center;
        }

        h2 {
            color: #2c3e50;
            text-align: center;
            font-size: 1.8em;
            margin-bottom: 25px;
        }
        
        #top-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        
        #end-game-btn {
            background-color: #e74c3c; 
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        #end-game-btn:hover {
            background-color: #c0392b;
        }
        
        #current-score-display {
            font-size: 1.2em;
            font-weight: bold;
            color: #2ecc71; 
        }

        #question-area {
            margin-top: 20px;
        }
        
        #question-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 1.1em;
            color: #555;
        }
        
        #question-type {
            display: none; /* ·∫®n lo·∫°i c√¢u h·ªèi */
        }

        #question-text {
            font-size: 1.5em; 
            color: #34495e;
            margin: 10px 0 25px 0; 
            line-height: 1.4;
        }

        #sentence {
            font-size: 1.5em;
            font-weight: bold;
            color: #3498db;
            text-align: center;
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            line-height: 1.5;
        }
        
        #options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; 
            gap: 15px; 
            margin-top: 25px;
        }

        .option-btn {
            padding: 18px; 
            font-size: 1.3em; 
            background-color: #f8f8f8; 
            border: 2px solid #dcdcdc; 
            border-radius: 8px; 
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: left;
            font-weight: 500;
        }
        .option-btn:hover:not(:disabled) {
            background-color: #e6f7ff; 
            border-color: #3498db;
        }
        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        #feedback {
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-top: 30px;
            height: 35px;
        }

        .correct { color: #2ecc71; }
        .incorrect { color: #e74c3c; }

        .btn-correct {
            background-color: #2ecc71 !important;
            color: white;
            border-color: #2ecc71 !important;
        }
        .btn-incorrect {
            background-color: #e74c3c !important;
            color: white;
            border-color: #e74c3c !important;
        }
        
        .action-btn {
            display: block; 
            min-width: 220px; 
            width: auto; 
            padding: 18px;
            font-size: 1.2em;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
            margin-left: auto; 
            margin-right: auto; 
            transition: all 0.3s ease;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0,0,0,0.3);
        }
        
        #next-btn {
            background-color: #3498db;
            box-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #3498db, 0 0 20px #3498db;
        }
        #next-btn:hover {
            background-color: #2980b9;
        }

        #check-btn {
            background-color: #f39c12; 
            box-shadow: 0 0 5px #fff, 0 0 10px #fff, 0 0 15px #f39c12, 0 0 20px #f39c12;
        }
        #check-btn:hover {
            background-color: #e67e22;
        }

        #order-question-area {
            display: none; 
        }
        
        #sentence-builder-box {
            min-height: 100px;
            border: 2px dashed #3498db;
            border-radius: 8px;
            padding: 10px;
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap; 
            gap: 10px;
            align-content: flex-start;
        }
        
        #word-bank-box {
            min-height: 50px;
            background-color: #ecf0f1;
            border-radius: 8px;
            padding: 10px;
            margin-top: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .word-tag {
            padding: 10px 15px;
            font-size: 1.3em;
            font-weight: 500;
            background-color: #ffffff;
            border: 1px solid #bdc3c7;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
            user-select: none; 
        }
        .word-tag:hover {
            background-color: #e6f7ff;
        }
        .word-tag:disabled {
            cursor: not-allowed;
            background-color: #f1f1f1;
            color: #999;
        }

        /* D·∫°ng 2 (G·∫°ch ch√¢n) */
        #clickable-sentence-area {
            display: none; 
            background-color: #ecf0f1;
            border-radius: 8px;
            padding: 25px;
            margin-top: 20px;
            text-align: center;
        }
        .syllable-span {
            display: inline-block;
            font-size: 1.8em; 
            font-weight: 500;
            color: #34495e;
            padding: 5px 8px;
            margin: 5px;
            cursor: pointer;
            user-select: none;
            border-radius: 5px;
            transition: all 0.2s ease;
        }
        .syllable-selected {
            text-decoration: underline;
            text-decoration-color: #3498db;
            text-decoration-thickness: 3px;
        }
        .syllable-correct {
            text-decoration: underline;
            text-decoration-color: #2ecc71; 
            text-decoration-thickness: 3px;
            color: #2ecc71;
            cursor: not-allowed;
        }
        .syllable-incorrect {
             text-decoration: underline;
            text-decoration-color: #e74c3c;
            text-decoration-thickness: 3px;
            color: #e74c3c;
        }

        /* C·ªôt th·ªëng k√™ */
        #stats-column h3 {
            color: #e74c3c; 
            font-size: 1.8em;
            margin-bottom: 25px;
        }
        #progress-bar-container {
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin: 30px 0;
            height: 150px; 
            display: flex;
            align-items: flex-end; 
            overflow: hidden; 
        }
        #progress-bar {
            width: 100%;
            height: 0%; 
            background-color: #2ecc71; 
            border-radius: 5px;
            transition: height 0.5s ease-out; 
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            text-shadow: 0 0 5px rgba(0,0,0,0.5); 
        }
        #total-questions-display {
            font-size: 1.3em;
            font-weight: bold;
            color: #555;
            margin-top: 15px;
        }
        #stats-timer-display {
            font-size: 1.3em;
            font-weight: bold;
            color: #3498db; 
            margin-top: 15px;
        }
        
        .volume-icon {
            font-size: 1.8em; 
            margin-right: 5px;
            color: #3498db; 
            cursor: pointer; 
            transition: color 0.2s;
        }
        .volume-icon:hover {
            color: #2980b9;
        }
    </style>
</head>
<body>
    
    <audio id="background-music" loop>
        <source src="nhac_nen.mp3" type="audio/mpeg">
    </audio>
    
<div id="main-content-column">
        <div id="top-controls">
            <h2>B√© √în B√†i</h2>
            <button id="end-game-btn" onclick="showFinalScreen()">K·∫øt th√∫c</button>
            <span id="current-score-display">ƒêi·ªÉm: 0</span>
        </div>

        <div id="question-area">
            <div id="question-header">
                <span id="speaker-btn" class="volume-icon">üîä</span> 
                <span id="question-type"></span>
            </div>
            
            <p id="question-text"></p>
            
            <p id="sentence"></p>
            <div id="options-grid"></div>
            
            <div id="order-question-area">
                <div id="sentence-builder-box"></div>
                <div id="word-bank-box"></div>
            </div>
            
            <div id="clickable-sentence-area"></div>
            
            <p id="feedback"></p>
            <button id="check-btn" class="action-btn" onclick="checkAnswer()" style="display: none;">Ki·ªÉm tra</button>
            <button id="next-btn" class="action-btn" onclick="nextQuestion()" style="display: none;">C√¢u ti·∫øp theo</button>
        </div>
    </div>

    <div id="stats-column">
        <h3>Th·ªëng k√™</h3>
        <div id="progress-bar-container">
            <div id="progress-bar">0%</div>
        </div>
        <p id="total-questions-display">0 / 160 c√¢u</p>
        <p id="stats-timer-display">Th·ªùi gian: 0:00</p>
    </div>

    <script src="cauhoi.js"></script>

    <script>
        // --- DANH S√ÅCH PH·∫¢N H·ªíI NG·∫™U NHI√äN ---
        const correctFeedbackMessages = [
            "ƒê√∫ng r·ªìi! Gi·ªèi qu√°!",
            "Ch√≠nh x√°c!",
            "Tuy·ªát v·ªùi!",
            "B√© th√¥ng minh qu√°!",
            "L√†m t·ªët l·∫Øm!",
            "Tuy·ªát c√∫ m√®o",
            "Xu·∫•t s·∫Øc!",
            "ƒê√°p √°n ho√†n h·∫£o!",
            "B√© nhanh nh∆∞ c·∫Øt!",
            "Con l√†m ƒë√∫ng r·ªìi!",
	    "Ho√†n h·∫£o!",
	    "B√© ƒë·ªânh qu√°!",
        ];
        
        const effortFeedbackMessages = [
            "B√© th·∫≠t tuy·ªát, r·∫•t c·ªë g·∫Øng!",
            "ƒê√∫ng r·ªìi! B√© ƒë√£ t√¨m ra ƒë√°p √°n!",
            "Con ƒë√£ l√†m ƒë∆∞·ª£c r·ªìi! T·ªët l·∫Øm!"
        ];

        let currentQuestionIndex = 0; 
        let correctCount = 0; 
        let timerInterval;         
        let startTime = Date.now(); 
        
        let canScorePoints = true; 

        
        // --- 2. L·∫§Y C√ÅC PH·∫¶N T·ª¨ HTML ---
        const questionTypeEl = document.getElementById('question-type');
        const questionTextEl = document.getElementById('question-text');
        const sentenceEl = document.getElementById('sentence');
        const optionsGridEl = document.getElementById('options-grid');
        const feedbackEl = document.getElementById('feedback');
        const nextBtn = document.getElementById('next-btn');
        const speakerBtn = document.getElementById('speaker-btn'); 
        const orderQuestionArea = document.getElementById('order-question-area');
        const sentenceBuilderBox = document.getElementById('sentence-builder-box');
        const wordBankBox = document.getElementById('word-bank-box');
        const checkBtn = document.getElementById('check-btn');
        const clickableSentenceArea = document.getElementById('clickable-sentence-area');
        const currentScoreDisplay = document.getElementById('current-score-display'); 
        const progressBar = document.getElementById('progress-bar');
        const totalQuestionsDisplay = document.getElementById('total-questions-display');
        const statsTimerDisplay = document.getElementById('stats-timer-display'); 

        // --- H√ÄM L·∫§Y PH·∫¢N H·ªíI NG·∫™U NHI√äN ---
        function getRandomFeedback(messageList) {
            const index = Math.floor(Math.random() * messageList.length);
            return messageList[index];
        }
        
        // --- H√ÄM X√ÅO TR·ªòN M·∫¢NG (Fisher-Yates) ---
        function shuffleArray(array) {
            let newArray = [...array]; 
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // --- H√ÄM X√ìA D·∫§U THANH (QUY T·∫ÆC C·ª¶A B·∫†N) ---
        function removeTone(str) {
            str = str.normalize('NFD');
            str = str.replace(/[\u0300\u0301\u0303\u0309\u0323]/g, "");
            return str.normalize('NFC');
        }
        
        // --- 3. H√ÄM ƒê·ªåC TI·∫æNG VI·ªÜT (N√∫t Loa) ---
        function speakText(textToSpeak) {
            if (!'speechSynthesis' in window) {
                alert('R·∫•t ti·∫øc, tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ƒë·ªçc ti·∫øng Vi·ªát.');
                return;
            }
            
            let processedText = textToSpeak;
            
            processedText = processedText.replace(/"ngh"/g, "ng·ªù gh√©p");
            processedText = processedText.replace(/"gh"/g, "g·ªù gh√©p");
            processedText = processedText.replace(/"ch"/g, "ch·ªù c·ªù h·ªù");
            processedText = processedText.replace(/"tr"/g, "tr·ªù t·ªù r·ªù");
            processedText = processedText.replace(/"th"/g, "th·ªù");
            processedText = processedText.replace(/"ng"/g, "ng·ªù");
            processedText = processedText.replace(/"k"/g, "ca");
            processedText = processedText.replace(/"c"/g, "c·ªù");
            processedText = processedText.replace(/"g"/g, "g·ªù");
            processedText = processedText.replace(/"r"/g, "r·ªù");
            processedText = processedText.replace(/"m"/g, "m·ªù");
            processedText = processedText.replace(/"n"/g, "n·ªù");
            processedText = processedText.replace(/"s"/g, "s·ªù s·∫ª");
            processedText = processedText.replace(/"x"/g, "x·ªù √≠ch x√¨");
            
            let utterance = new SpeechSynthesisUtterance(processedText);
            utterance.lang = 'vi-VN'; 
            utterance.rate = 1; 
            
            window.speechSynthesis.cancel();
            window.speechSynthesis.speak(utterance);
        }

        // --- 4. H√ÄM C·∫¨P NH·∫¨T TH·ªêNG K√ä ---
        function updateStats() {
            currentScoreDisplay.textContent = `ƒêi·ªÉm: ${correctCount}`;
            totalQuestionsDisplay.textContent = `${currentQuestionIndex} / ${questions.length} c√¢u`;
            
            const progress = (currentQuestionIndex / questions.length) * 100;
            progressBar.style.height = `${progress}%`;
            progressBar.textContent = `${Math.round(progress)}%`;
        }

        // --- 5. H√ÄM B·∫ÆT ƒê·∫¶U ƒê·∫æM GI·ªú ---
        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsedTime = Date.now() - startTime; 
                const minutes = Math.floor(elapsedTime / 60000);
                const seconds = Math.floor((elapsedTime % 60000) / 1000);
                const formattedTime = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                statsTimerDisplay.textContent = `Th·ªùi gian: ${formattedTime}`;
            }, 1000); 
        }

        // --- 6. H√ÄM T·∫¢I C√ÇU H·ªéI ---
        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showFinalScreen();
                return;
            }
            
            canScorePoints = true; 
            
            let q = questions[currentQuestionIndex]; 

            questionTypeEl.textContent = q.type;
            questionTextEl.textContent = q.question;
            
            speakerBtn.onclick = () => {
                let textToRead = q.question;
                if ((q.qType === 'SELECT' || q.qType === 'CLICKABLE') && q.sentence) {
                    textToRead += ". " + q.sentence;
                }
                speakText(textToRead);
            };

            optionsGridEl.style.display = 'none'; 
            orderQuestionArea.style.display = 'none'; 
            clickableSentenceArea.style.display = 'none';
            sentenceEl.style.display = 'none';
            checkBtn.style.display = 'none'; 


            if (q.qType === 'SELECT') {
                optionsGridEl.style.display = 'grid'; 
                if (q.sentence) {
                    sentenceEl.textContent = `${q.sentence}`; 
                    sentenceEl.style.display = 'block';
                }
                
                optionsGridEl.innerHTML = '';
                const labels = ["A.", "B.", "C.", "D."];
                const shuffledOptions = shuffleArray(q.options);
                
                shuffledOptions.forEach((optionValue, index) => {
                    const button = document.createElement('button');
                    button.textContent = `${labels[index]} ${optionValue}`;
                    button.className = 'option-btn';
                    button.onclick = () => checkSelectAnswer(optionValue, q.correctAnswer, button);
                    optionsGridEl.appendChild(button);
                });

            } else if (q.qType === 'ORDER') {
                orderQuestionArea.style.display = 'block'; 
                checkBtn.style.display = 'block'; 
                checkBtn.onclick = () => checkOrderAnswer(); 

                sentenceBuilderBox.innerHTML = '';
                wordBankBox.innerHTML = '';
                
                const shuffledWords = shuffleArray(q.words);
                shuffledWords.forEach(word => {
                    createWordTag(word, 'bank');
                });
            
            } else if (q.qType === 'CLICKABLE') {
                clickableSentenceArea.style.display = 'block';
                checkBtn.style.display = 'block';
                checkBtn.onclick = () => checkClickableAnswer(); 
                
                clickableSentenceArea.innerHTML = ''; 
                const syllables = q.sentence.split(' '); 
                
                syllables.forEach(syllable => {
                    const span = document.createElement('span');
                    span.textContent = syllable;
                    span.className = 'syllable-span';
                    span.onclick = () => {
                        span.classList.toggle('syllable-selected');
                    };
                    clickableSentenceArea.appendChild(span);
                });
            }

            feedbackEl.textContent = '';
            nextBtn.style.display = 'none';
            updateStats(); 
        }

        // --- 7. H√ÄM KI·ªÇM TRA ƒê√ÅP √ÅN (D·∫°ng 4 - Ch·ªçn) ---
        function checkSelectAnswer(selectedValue, correctAnswer, clickedButton) {
            
            if (selectedValue === correctAnswer) {
                document.querySelectorAll('.option-btn').forEach(btn => {
                    btn.disabled = true;
                    // T√°ch gi√° tr·ªã sau "A. "
                    const btnValue = btn.textContent.substring(btn.textContent.indexOf(' ') + 1);
                    if (btnValue === correctAnswer) {
                        btn.classList.add('btn-correct');
                    }
                });

                if (canScorePoints) {
                    const feedback = getRandomFeedback(correctFeedbackMessages);
                    feedbackEl.textContent = feedback;
                    speakText(feedback);
                    correctCount += 10;
                } else {
                    const feedback = getRandomFeedback(effortFeedbackMessages);
                    feedbackEl.textContent = feedback;
                    speakText(feedback);
                }
                updateStats();
                nextBtn.style.display = 'block';
            } else {
                clickedButton.disabled = true; 
                clickedButton.classList.add('btn-incorrect'); 
                feedbackEl.textContent = "Sai r·ªìi. Con xem l·∫°i nh√©!";
                feedbackEl.className = "incorrect";
                speakText("Sai r·ªìi. Con xem l·∫°i nh√©!");
                canScorePoints = false;
            }
        }

        // --- 8. C√ÅC H√ÄM CHO D·∫†NG 6 (S·∫ÆP X·∫æP) ---
        function createWordTag(word, location) {
            const wordTag = document.createElement('div');
            wordTag.textContent = word;
            wordTag.className = 'word-tag';
            
            if (location === 'bank') {
                wordTag.onclick = () => moveWord(wordTag, 'toSentence');
                wordBankBox.appendChild(wordTag);
            } else {
                wordTag.onclick = () => moveWord(wordTag, 'toBank');
                sentenceBuilderBox.appendChild(wordTag);
            }
        }
        function moveWord(wordTag, direction) {
            if (direction === 'toSentence') {
                sentenceBuilderBox.appendChild(wordTag); 
                wordTag.onclick = () => moveWord(wordTag, 'toBank'); 
            } else {
                wordBankBox.appendChild(wordTag); 
                wordTag.onclick = () => moveWord(wordTag, 'toSentence'); 
            }
        }
        function checkOrderAnswer() {
            let q = questions[currentQuestionIndex];
            const wordsInSentenceBox = sentenceBuilderBox.querySelectorAll('.word-tag');
            let userAnswer = '';
            wordsInSentenceBox.forEach((tag, index) => {
                userAnswer += tag.textContent;
                if (index < wordsInSentenceBox.length - 1) {
                    userAnswer += ' '; 
                }
            });
            
            if (userAnswer === q.correctAnswer) {
                if (canScorePoints) {
                    const feedback = getRandomFeedback(correctFeedbackMessages);
                    feedbackEl.textContent = feedback;
                    speakText(feedback);
                    correctCount += 10;
                } else {
                    const feedback = getRandomFeedback(effortFeedbackMessages);
                    feedbackEl.textContent = feedback;
                    speakText(feedback);
                }
                updateStats(); 
                document.querySelectorAll('.word-tag').forEach(tag => {
                    tag.onclick = null; 
                    tag.disabled = true; 
                });
                checkBtn.style.display = 'none'; 
                nextBtn.style.display = 'block'; 
            } else {
                feedbackEl.textContent = "Ch∆∞a ƒë√∫ng r·ªìi, c·ªë g·∫Øng nh√©, b√© l√†m l·∫°i.";
                feedbackEl.className = "incorrect";
                speakText("Ch∆∞a ƒë√∫ng r·ªìi, c·ªë g·∫Øng nh√©, b√© l√†m l·∫°i."); 
                canScorePoints = false;
            }
        }

        // --- 9. H√ÄM KI·ªÇM TRA ƒê√ÅP √ÅN (D·∫°ng 2 - G·∫°ch ch√¢n) ---
        function checkClickableAnswer() {
            let q = questions[currentQuestionIndex];
            const targetSound = q.targetSound;
            
            const allSyllables = document.querySelectorAll('.syllable-span');
            let correctAnswers = [];
            allSyllables.forEach(span => {
                const syllable = span.textContent;
                const cleanedSyllable = removeTone(syllable);
                
                if (cleanedSyllable.toLowerCase().includes(targetSound.toLowerCase())) {
                    correctAnswers.push(syllable);
                }
            });

            const selectedSpans = document.querySelectorAll('.syllable-selected');
            const userAnswers = Array.from(selectedSpans).map(span => span.textContent);
            
            const isCorrect = userAnswers.length === correctAnswers.length && 
                              userAnswers.every(answer => correctAnswers.includes(answer));

            if (isCorrect) {
                if (canScorePoints) {
                    const feedback = getRandomFeedback(correctFeedbackMessages);
                    feedbackEl.textContent = feedback;
                    speakText(feedback);
                    correctCount += 10;
                } else {
                    const feedback = getRandomFeedback(effortFeedbackMessages);
                    feedbackEl.textContent = feedback;
                    speakText(feedback);
                }
                
                document.querySelectorAll('.syllable-span').forEach(span => {
                    span.onclick = null; 
                    span.classList.remove('syllable-selected'); 
                    if (correctAnswers.includes(span.textContent)) {
                        span.classList.add('syllable-correct'); 
                    }
                });
                updateStats();
                checkBtn.style.display = 'none';
                nextBtn.style.display = 'block';
            } else {
                feedbackEl.textContent = "Ch∆∞a ƒë√∫ng r·ªìi, c·ªë g·∫Øng nh√©, b√© l√†m l·∫°i.";
                feedbackEl.className = "incorrect";
                speakText("Ch∆∞a ƒë√∫ng r·ªìi, c·ªë g·∫Øng nh√©, b√© l√†m l·∫°i."); 
                canScorePoints = false;
            }
        }

        // --- 10. H√ÄM CHUY·ªÇN C√ÇU H·ªéI ---
        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion(); 
        }

        // --- 11. H√ÄM HI·ªÇN TH·ªä M√ÄN H√åNH K·∫æT TH√öC ---
        function showFinalScreen() {
            clearInterval(timerInterval); 
            
            progressBar.style.height = '100%';
            progressBar.textContent = '100%';
            totalQuestionsDisplay.textContent = `${questions.length} / ${questions.length} c√¢u`;

            document.getElementById('question-area').innerHTML = `
                <h3 style="text-align: center; font-size: 1.8em; color: #2ecc71;">Ch√∫c m·ª´ng!</h3>
                <p style="text-align: center; font-size: 1.3em; margin-top: 15px;">B√© ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c b√†i t·∫≠p.</p>
                <p style="text-align: center; font-size: 1.5em; font-weight: bold; margin-top: 20px;">
                    T·ªïng ƒëi·ªÉm: <span style="color: #3498db;">${correctCount}</span>
                </p>
                <p style="text-align: center; font-size: 1.3em;">
                    (ƒê√∫ng ${correctCount / 10} / ${questions.length} c√¢u)
                </p>
                <p style="text-align: center; font-size: 1.3em; margin-top: 10px;">
                    T·ªïng th·ªùi gian: <span style="color: #e74c3c;">${statsTimerDisplay.textContent.replace('Th·ªùi gian: ', '')}</span>
                </p>
            `;
            document.getElementById('end-game-btn').disabled = true;
        }

        // --- 12. B·∫ÆT ƒê·∫¶U ·ª®NG D·ª§NG ---
        
        try {
            questions = shuffleArray(questions);
        } catch (e) {
            console.error(e);
            alert("L·ªñI: Kh√¥ng th·ªÉ x√°o tr·ªôn c√¢u h·ªèi. Bi·∫øn 'questions' trong 'cauhoi.js' c√≥ th·ªÉ ƒëang l√† 'const'. H√£y s·ª≠a n√≥ th√†nh 'let'.");
        }
        
        document.body.addEventListener('click', () => {
            const music = document.getElementById('background-music');
            if (music && music.paused) {
                music.volume = 0.2; 
                music.play().catch(error => {
                    console.log("L·ªói ph√°t nh·∫°c: ", error);
                });
            }
        }, { once: true }); 

        // T·ª± ƒë·ªông c·∫≠p nh·∫≠t t·ªïng s·ªë c√¢u t·ª´ file 'cauhoi.js'
        document.getElementById('total-questions-display').textContent = `0 / ${questions.length} c√¢u`;
        
        loadQuestion(); 
        startTimer();   
        updateStats();  
    </script>
</body>
</html>


